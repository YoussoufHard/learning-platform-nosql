<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Platform - API Test</title>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Learning Platform API Test</h1>

        <!-- Create Course Form -->
        <div class="card mt-5">
            <div class="card-body">
                <h2>Create a new Course</h2>
                <form id="create-course-form">
                    <div class="mb-3">
                        <label for="name" class="form-label">Course Name:</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="duration" class="form-label">Course Duration (in weeks):</label>
                        <input type="number" id="duration" name="duration" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Course</button>
                </form>
            </div>
        </div>

        <!-- Course Actions -->
        <div class="card mt-5">
            <div class="card-body">
                <h2>Test Course Actions</h2>
                <button id="get-course" class="btn btn-info">Get Course by ID</button>
                <button id="update-course" class="btn btn-warning">Update Course</button>
                <button id="delete-course" class="btn btn-danger">Delete Course</button>
                <button id="get-stats" class="btn btn-secondary">Get Course Stats</button>
            </div>
        </div>

         <!-- All Courses Section -->
         <div class="card mt-5">
             <div class="card-body">
                 <h2>All Courses</h2>
                 <button id="fetch-courses" class="btn btn-success">Fetch All Courses</button>
                 <ul id="course-list" class="list-group mt-3"></ul>
             </div>
         </div>

    </div>

    <script>
        // Create a course
        document.getElementById('create-course-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const duration = document.getElementById('duration').value;

            const response = await fetch('http://localhost:3000/courses', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, duration })
            });

            const data = await response.json();
            if (response.status === 201) {
                alert('Course created successfully!');
                $('#create-course-form')[0].reset();  // Reset the form
            } else {
                alert('Failed to create course: ' + data.error);
            }
        });

        // Fetch all courses
        document.getElementById('fetch-courses').addEventListener('click', async () => {
            const response = await fetch('http://localhost:3000/courses');
            const courses = await response.json();

            const courseList = document.getElementById('course-list');
            courseList.innerHTML = ''; // Clear the list

            if (Array.isArray(courses)) {
                courses.forEach(course => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('list-group-item');
                    listItem.textContent = `Course Name: ${course.name}, Duration: ${course.duration} weeks`;
                    courseList.appendChild(listItem);
                });
            } else {
                alert('No courses found.');
            }
        });

        // Get Course by ID
        document.getElementById('get-course').addEventListener('click', async () => {
            const courseId = prompt("Enter Course ID:");
            if (courseId) {
                const response = await fetch(`http://localhost:3000/courses/${courseId}`);
                const course = await response.json();
                if (response.status === 200) {
                    alert(`Course: ${course.name}, Duration: ${course.duration} weeks`);
                } else {
                    alert('Course not found.');
                }
            }
        });

        // Update Course
        document.getElementById('update-course').addEventListener('click', async () => {
            const courseId = prompt("Enter Course ID to Update:");
            const name = prompt("Enter new Course Name:");
            const duration = prompt("Enter new Course Duration (in weeks):");

            if (courseId && name && duration) {
                const response = await fetch(`http://localhost:3000/courses/${courseId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, duration })
                });

                const data = await response.json();
                if (response.status === 200) {
                    alert('Course updated successfully!');
                } else {
                    alert('Failed to update course: ' + data.error);
                }
            }
        });

        // Delete Course
        document.getElementById('delete-course').addEventListener('click', async () => {
            const courseId = prompt("Enter Course ID to Delete:");
            if (courseId) {
                const response = await fetch(`http://localhost:3000/courses/${courseId}`, {
                    method: 'DELETE',
                });

                const data = await response.json();
                if (response.status === 200) {
                    alert('Course deleted successfully!');
                } else {
                    alert('Failed to delete course: ' + data.error);
                }
            }
        });

        // Get Course Stats
        document.getElementById('get-stats').addEventListener('click', async () => {
            const response = await fetch('http://localhost:3000/courses/stats');
            const stats = await response.json();
            if (response.status === 200) {
                alert(`Total Courses: ${stats.totalCourses}, Average Rating: ${stats.averageRating}`);
            } else {
                alert('Failed to fetch course stats.');
            }
        });
    </script>
</body>
</html>
